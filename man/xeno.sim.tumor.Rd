\name{xeno.sim.tumor}
\alias{xeno.sim.tumor}
%- Also NEED an '\alias' for EACH other topic documented here.
\title{
Function for simulating a tumor according to a lme4 model fit
}
\description{
Simulated tumor data.frames are generated by this function according to a provided 
lme4-model fit. Formulation of the model and the original achieved fit affect the 
resulting simulated datasets. Visualization of the simulated datasets is emphasized 
before actual power analysis. The function can be used for both categorizing 
(covariate Growth) and non-categorizing model fits.
}
\usage{
xeno.sim.tumor(fit, responsename = "Response", 
treatmentname = "Treatment", tpname = "Timepoint", 
idname = "Tumor_id", N = 10, T = max(fit@frame[[tpname]]))
}
%- maybe also 'usage' for other objects documented here.
\arguments{
  \item{fit}{
Mixed-effects model object fit with lme4 (mer).
}
  \item{responsename}{
Column name with the response values in the data.frame. Defaults to "Response".
}
  \item{treatmentname}{
Column name with the binary treatment group indicators in the data.frame. 
Defaults to "Treatment".
}
  \item{tpname}{
Column name with the time points in the data.frame. Defaults to "Timepoint".
}
  \item{idname}{
Column name with the individual tumor or animal labels in the data.frame. 
Defaults to "Tumor_id".
}
  \item{N}{
Number of tumors per treatment group, equal amount per group.
}
  \item{T}{
Last measured time point. Defaults to the last original measured time point.
}
}
\details{
%%  ~~ If necessary, more details than the description above ~~
}
\value{
A simulated data.frame containing the neccessary fields to fit a mixed-effects model.
%%  ~Describe the value returned
%%  If it is a LIST, use
%%  \item{comp1 }{Description of 'comp1'}
%%  \item{comp2 }{Description of 'comp2'}
%% ...
}
\references{
Gelman A, Hill J. Multilevel power calculation using fake-data simulation. 
In: Alvarez RM, Beck NL, Wu LL (editors). Data analysis using regression 
and multilevel/hierarchical models, Cambridge University Press; 2007. p. 449-54.
}
\author{
Teemu D Laajala <tlaajala@cc.hut.fi>
}
\note{
The simulation model might need adjustment depending on the response profiles. 
For example with datasets with increased amounts of informative censored, residing 
profiles around zero tumor response, it might be reasonable to modify the random 
slope to be allowed only for growing tumors by adjusting the term to 
(0 + Timepoint:Growth|Tumor_id). If the residual variance is very large compared 
to the random effects' variance, the model requires adjustment to possibly 
non-linear shape. Only binary categorization is supported at the moment.

The approach for power analysis through simulated dataset was adopted from Gelman & Hill.
}

%% ~Make other sections like Warning with \section{Warning }{....} ~

\seealso{
\code{\link{xeno.sim.power}}
}
\examples{
# MCF-7 LAR low dosage example dataset
data(mcf_low)

# Categorizing fit
mcf_low_EM = xeno.EM(data=mcf_low, formula=Response ~ 1 + Treatment + 
Timepoint:Growth + Treatment:Timepoint:Growth + (1|Tumor_id) + (0+Timepoint|Tumor_id))
mcf_low_fit = lmer(data=mcf_low_EM, Response ~ 1 + Treatment + Timepoint:Growth + 
Treatment:Timepoint:Growth + (1|Tumor_id) + (0+Timepoint|Tumor_id))

par(mfrow=c(2,2))
# Testing simulated datas of different lengths (original length T=5)
Ts = c(4:7)
for(i in 1:4){
	simulated_data = xeno.sim.tumor(mcf_low_fit, N=10, T=Ts[i], 
	responsename="Response")
	simulated_fit = lmer(data=simulated_data, Response ~ 1 + Treatment + 
	Timepoint:Growth + 	Treatment:Timepoint:Growth + (1|Tumor_id) + 
	(0+Timepoint|Tumor_id))
	xeno.draw.data(simulated_fit, maintitle="Simulated Data")
}

}
% Add one or more standard keywords, see file 'KEYWORDS' in the
% R documentation directory.
\keyword{ simulation }
\keyword{ power }
